<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head runat="server">
    <title>eWallet</title>
  </head>
  <body>
    <button id="rzp-button1">Pay with Razorpay</button>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>
      var order_id;
      var customer_name;
      var mobile_number;
      var email_id;
      var amount = 100;
      var token =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqd3RfZW1haWxJZCI6Inlhc2hsYXRoaXlhcmtpdEBnbWFpbC5jb20iLCJqd3RfdXNlcklkIjoiMTciLCJqd3Rfd2FsbGV0SWQiOiIxMiIsImV4cCI6MTcxNTIzOTcxNiwiaXNzIjoiaHR0cHM6Ly9sb2NhbGhvc3Q6NzI3ODtodHRwOi8vbG9jYWxob3N0OjUwNjM7aHR0cDovL2xvY2FsaG9zdDozMjgwOSIsImF1ZCI6Imh0dHBzOi8vbG9jYWxob3N0OjcyNzg7aHR0cDovL2xvY2FsaG9zdDo1MDYzO2h0dHA6Ly9sb2NhbGhvc3Q6MzI4MDkifQ.SfDXkjrcxNWdkIZ-_omZX3XGNYi9xvVrmVRxcAa3Dr4";
      // Fetch the order ID
      fetch("https://localhost:7278/api/CLTest/GenerateOrderId", {
        method: "POST",
        headers: {
          Authorization: "Bearer " + token,
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          amount: amount,
        }),
      })
        .then((res) => res.json()) // Assuming response is JSON
        .then((data) => {
          console.log(data);
          order_id = data.message;
          // Fetch customer info
          fetch("https://localhost:7278/api/CLUser/info", {
            method: "GET",
            headers: {
              Authorization: "Bearer " + token,
            },
          })
            .then((usrResponse) => usrResponse.json())
            .then((usrData) => {
              console.log(usrData);

              // Use the order ID and customer info to set options
              var options = {
                key: "rzp_test_8qr1ipXJ76cjtN",
                amount: amount,
                currency: "INR",
                name: "eWallet",
                description: "Deposit into eWallet",
                order_id: order_id,
                image:
                  "https://img.freepik.com/premium-vector/e-wallet-logo-vector-art-inspiration_24599-185.jpg",
                prefill: {
                  name: usrData.data.firstName + " " + usrData.data.lastName,
                  email: usrData.data.emailId,
                  contact: usrData.data.mobileNumber,
                },
                notes: {
                  address: "Hello World",
                },
                theme: {
                  color: "#3399cc",
                },
                handler: function (response) {
                  fetch("https://localhost:7278/api/CLTest/PaymentByRazorpay", {
                    method: "POST",
                    headers: {
                      "Content-Type": "application/json",
                      Authorization: "Bearer " + token,
                    },
                    body: JSON.stringify(response),
                  })
                    .then((res) => res.json())
                    .then((res) => {
                      if (res.HasError) {
                        alert("Payment is unsuccessful" + res.message);
                      } else {
                        alert("Payment is successful");
                      }
                    })
                    .catch((error) => {
                      console.error("Error:", error);
                    });
                },
              };

              // Initialize Razorpay with options
              var rzp = new Razorpay(options);
              rzp.on("payment.failed", function (response) {
                alert(JSON.stringify(response));
              });
              document.getElementById("rzp-button1").onclick = function (e) {
                rzp.open();
                e.preventDefault();
              };
            });
        })
        .catch((error) => {
          console.error("Error:", error);
        });
    </script>
  </body>
</html>
